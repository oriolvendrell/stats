package stats

import "math"

// import (
// 	"math"
// )

// StudentsT is used to represent the students t distribution parameters
type StudentsT struct {
	V float64
}

// func (t studentsT) CDF(x float64, v int) float64 {
// 	if x == 0 {
// 		return 0.5
// 	} else if x > 0 {
// 		return 1 - 0.5*regIncBeta(t.v/(x*x+t.v), t.v/2, 0.5)
// 	} else if x < 0 {
// 		return 1 - (1 - 0.5*regIncBeta(t.v/(x*x+t.v), t.v/2, 0.5))
// 	} else {
// 		return math.NaN()
// 	}
// }

// //TODO: improve this functions.
// func lgamma(input float64) float64 {
// 	res, _ := math.Lgamma(input)
// 	return res
// }
// func regIncBeta(x, a, b float64) float64 {
// 	return math.Exp(lgamma(a) + lgamma(b) - lgamma(a+b))
// }

//GetTStatistic returns the t statistic value
func GetTStatistic(v float64, alpha float64) float64 {
	var rowidx int
	if v <= 100 {
		rowidx = int(v) - 1
	} else {
		rowidx = len(tStudentTable.row)
	}
	return tStudentTable.interpolateCols(alpha, rowidx)
}

//Data from: https://www.itl.nist.gov/div898/handbook/eda/section3/eda3672.htm
var tStudentTable statsTable = statsTable{
	[][]float64{
		[]float64{3.078, 6.314, 12.706, 31.821, 63.657, 318.313},
		[]float64{1.886, 2.920, 4.303, 6.965, 9.925, 22.327},
		[]float64{1.638, 2.353, 3.182, 4.541, 5.841, 10.215},
		[]float64{1.533, 2.132, 2.776, 3.747, 4.604, 7.173},
		[]float64{1.476, 2.015, 2.571, 3.365, 4.032, 5.893},
		[]float64{1.440, 1.943, 2.447, 3.143, 3.707, 5.208},
		[]float64{1.415, 1.895, 2.365, 2.998, 3.499, 4.782},
		[]float64{1.397, 1.860, 2.306, 2.896, 3.355, 4.499},
		[]float64{1.383, 1.833, 2.262, 2.821, 3.250, 4.296},
		[]float64{1.372, 1.812, 2.228, 2.764, 3.169, 4.143},
		[]float64{1.363, 1.796, 2.201, 2.718, 3.106, 4.024},
		[]float64{1.356, 1.782, 2.179, 2.681, 3.055, 3.929},
		[]float64{1.350, 1.771, 2.160, 2.650, 3.012, 3.852},
		[]float64{1.345, 1.761, 2.145, 2.624, 2.977, 3.787},
		[]float64{1.341, 1.753, 2.131, 2.602, 2.947, 3.733},
		[]float64{1.337, 1.746, 2.120, 2.583, 2.921, 3.686},
		[]float64{1.333, 1.740, 2.110, 2.567, 2.898, 3.646},
		[]float64{1.330, 1.734, 2.101, 2.552, 2.878, 3.610},
		[]float64{1.328, 1.729, 2.093, 2.539, 2.861, 3.579},
		[]float64{1.325, 1.725, 2.086, 2.528, 2.845, 3.552},
		[]float64{1.323, 1.721, 2.080, 2.518, 2.831, 3.527},
		[]float64{1.321, 1.717, 2.074, 2.508, 2.819, 3.505},
		[]float64{1.319, 1.714, 2.069, 2.500, 2.807, 3.485},
		[]float64{1.318, 1.711, 2.064, 2.492, 2.797, 3.467},
		[]float64{1.316, 1.708, 2.060, 2.485, 2.787, 3.450},
		[]float64{1.315, 1.706, 2.056, 2.479, 2.779, 3.435},
		[]float64{1.314, 1.703, 2.052, 2.473, 2.771, 3.421},
		[]float64{1.313, 1.701, 2.048, 2.467, 2.763, 3.408},
		[]float64{1.311, 1.699, 2.045, 2.462, 2.756, 3.396},
		[]float64{1.310, 1.697, 2.042, 2.457, 2.750, 3.385},
		[]float64{1.309, 1.696, 2.040, 2.453, 2.744, 3.375},
		[]float64{1.309, 1.694, 2.037, 2.449, 2.738, 3.365},
		[]float64{1.308, 1.692, 2.035, 2.445, 2.733, 3.356},
		[]float64{1.307, 1.691, 2.032, 2.441, 2.728, 3.348},
		[]float64{1.306, 1.690, 2.030, 2.438, 2.724, 3.340},
		[]float64{1.306, 1.688, 2.028, 2.434, 2.719, 3.333},
		[]float64{1.305, 1.687, 2.026, 2.431, 2.715, 3.326},
		[]float64{1.304, 1.686, 2.024, 2.429, 2.712, 3.319},
		[]float64{1.304, 1.685, 2.023, 2.426, 2.708, 3.313},
		[]float64{1.303, 1.684, 2.021, 2.423, 2.704, 3.307},
		[]float64{1.303, 1.683, 2.020, 2.421, 2.701, 3.301},
		[]float64{1.302, 1.682, 2.018, 2.418, 2.698, 3.296},
		[]float64{1.302, 1.681, 2.017, 2.416, 2.695, 3.291},
		[]float64{1.301, 1.680, 2.015, 2.414, 2.692, 3.286},
		[]float64{1.301, 1.679, 2.014, 2.412, 2.690, 3.281},
		[]float64{1.300, 1.679, 2.013, 2.410, 2.687, 3.277},
		[]float64{1.300, 1.678, 2.012, 2.408, 2.685, 3.273},
		[]float64{1.299, 1.677, 2.011, 2.407, 2.682, 3.269},
		[]float64{1.299, 1.677, 2.010, 2.405, 2.680, 3.265},
		[]float64{1.299, 1.676, 2.009, 2.403, 2.678, 3.261},
		[]float64{1.298, 1.675, 2.008, 2.402, 2.676, 3.258},
		[]float64{1.298, 1.675, 2.007, 2.400, 2.674, 3.255},
		[]float64{1.298, 1.674, 2.006, 2.399, 2.672, 3.251},
		[]float64{1.297, 1.674, 2.005, 2.397, 2.670, 3.248},
		[]float64{1.297, 1.673, 2.004, 2.396, 2.668, 3.245},
		[]float64{1.297, 1.673, 2.003, 2.395, 2.667, 3.242},
		[]float64{1.297, 1.672, 2.002, 2.394, 2.665, 3.239},
		[]float64{1.296, 1.672, 2.002, 2.392, 2.663, 3.237},
		[]float64{1.296, 1.671, 2.001, 2.391, 2.662, 3.234},
		[]float64{1.296, 1.671, 2.000, 2.390, 2.660, 3.232},
		[]float64{1.296, 1.670, 2.000, 2.389, 2.659, 3.229},
		[]float64{1.295, 1.670, 1.999, 2.388, 2.657, 3.227},
		[]float64{1.295, 1.669, 1.998, 2.387, 2.656, 3.225},
		[]float64{1.295, 1.669, 1.998, 2.386, 2.655, 3.223},
		[]float64{1.295, 1.669, 1.997, 2.385, 2.654, 3.220},
		[]float64{1.295, 1.668, 1.997, 2.384, 2.652, 3.218},
		[]float64{1.294, 1.668, 1.996, 2.383, 2.651, 3.216},
		[]float64{1.294, 1.668, 1.995, 2.382, 2.650, 3.214},
		[]float64{1.294, 1.667, 1.995, 2.382, 2.649, 3.213},
		[]float64{1.294, 1.667, 1.994, 2.381, 2.648, 3.211},
		[]float64{1.294, 1.667, 1.994, 2.380, 2.647, 3.209},
		[]float64{1.293, 1.666, 1.993, 2.379, 2.646, 3.207},
		[]float64{1.293, 1.666, 1.993, 2.379, 2.645, 3.206},
		[]float64{1.293, 1.666, 1.993, 2.378, 2.644, 3.204},
		[]float64{1.293, 1.665, 1.992, 2.377, 2.643, 3.202},
		[]float64{1.293, 1.665, 1.992, 2.376, 2.642, 3.201},
		[]float64{1.293, 1.665, 1.991, 2.376, 2.641, 3.199},
		[]float64{1.292, 1.665, 1.991, 2.375, 2.640, 3.198},
		[]float64{1.292, 1.664, 1.990, 2.374, 2.640, 3.197},
		[]float64{1.292, 1.664, 1.990, 2.374, 2.639, 3.195},
		[]float64{1.292, 1.664, 1.990, 2.373, 2.638, 3.194},
		[]float64{1.292, 1.664, 1.989, 2.373, 2.637, 3.193},
		[]float64{1.292, 1.663, 1.989, 2.372, 2.636, 3.191},
		[]float64{1.292, 1.663, 1.989, 2.372, 2.636, 3.190},
		[]float64{1.292, 1.663, 1.988, 2.371, 2.635, 3.189},
		[]float64{1.291, 1.663, 1.988, 2.370, 2.634, 3.188},
		[]float64{1.291, 1.663, 1.988, 2.370, 2.634, 3.187},
		[]float64{1.291, 1.662, 1.987, 2.369, 2.633, 3.185},
		[]float64{1.291, 1.662, 1.987, 2.369, 2.632, 3.184},
		[]float64{1.291, 1.662, 1.987, 2.368, 2.632, 3.183},
		[]float64{1.291, 1.662, 1.986, 2.368, 2.631, 3.182},
		[]float64{1.291, 1.662, 1.986, 2.368, 2.630, 3.181},
		[]float64{1.291, 1.661, 1.986, 2.367, 2.630, 3.180},
		[]float64{1.291, 1.661, 1.986, 2.367, 2.629, 3.179},
		[]float64{1.291, 1.661, 1.985, 2.366, 2.629, 3.178},
		[]float64{1.290, 1.661, 1.985, 2.366, 2.628, 3.177},
		[]float64{1.290, 1.661, 1.985, 2.365, 2.627, 3.176},
		[]float64{1.290, 1.661, 1.984, 2.365, 2.627, 3.175},
		[]float64{1.290, 1.660, 1.984, 2.365, 2.626, 3.175},
		[]float64{1.290, 1.660, 1.984, 2.364, 2.626, 3.174},
		[]float64{1.282, 1.645, 1.960, 2.326, 2.576, 3.090}},

	[]float64{
		1.0,
		2.0,
		3.0,
		4.0,
		5.0,
		6.0,
		7.0,
		8.0,
		9.0,
		10.0,
		11.0,
		12.0,
		13.0,
		14.0,
		15.0,
		16.0,
		17.0,
		18.0,
		19.0,
		20.0,
		21.0,
		22.0,
		23.0,
		24.0,
		25.0,
		26.0,
		27.0,
		28.0,
		29.0,
		30.0,
		31.0,
		32.0,
		33.0,
		34.0,
		35.0,
		36.0,
		37.0,
		38.0,
		39.0,
		40.0,
		41.0,
		42.0,
		43.0,
		44.0,
		45.0,
		46.0,
		47.0,
		48.0,
		49.0,
		50.0,
		51.0,
		52.0,
		53.0,
		54.0,
		55.0,
		56.0,
		57.0,
		58.0,
		59.0,
		60.0,
		61.0,
		62.0,
		63.0,
		64.0,
		65.0,
		66.0,
		67.0,
		68.0,
		69.0,
		70.0,
		71.0,
		72.0,
		73.0,
		74.0,
		75.0,
		76.0,
		77.0,
		78.0,
		79.0,
		80.0,
		81.0,
		82.0,
		83.0,
		84.0,
		85.0,
		86.0,
		87.0,
		88.0,
		89.0,
		90.0,
		91.0,
		92.0,
		93.0,
		94.0,
		95.0,
		96.0,
		97.0,
		98.0,
		99.0,
		100.0,
		math.Inf(1.0)},

	//[0.90,    0.95,   0.975,    0.99,   0.995,   0.999]  1-alpha
	[]float64{0.1, 0.05, 0.025, 0.01, 0.005, 0.001},
}
